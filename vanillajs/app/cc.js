var d=document.querySelector("#app"),g=/^\/$|top|newest|show|ask|jobs/;document.body.addEventListener("click",function(a){var b=a.target;b.classList.contains("page")&&(a.preventDefault(),history.pushState({offset:0},"",""+b.getAttribute("href")),h(0,b.dataset.scope));b.classList.contains("comments")&&(a.preventDefault(),a=b["story-id"],history.pushState({a:a},"","/story/"+a),k(a))});function l(a,b){return fetch(a+".json"+(void 0===b?"":b)).then(function(a){return a.json()})}
function m(a,b,c){c.filter(function(a){return!a.deleted}).map(n).forEach(function(c){a.appendChild(c);b&&p(c.kids,a)})}function p(a,b){a&&a.length&&l("/items","?ids="+a.join(",")).then(m.bind(null,b,!0))}function n(a){var b=q("ul",{className:"kid-root","story-id":a.id},q("li",{},q("div",{className:"comment-info sub-info"},q("div",{className:"author"},a.by)),q("p",{className:"comment-text",innerHTML:a.text})));p(a.kids,b);return b}
function k(a){d.innerHTML="";l("https://hacker-news.firebaseio.com/v0/item/"+a).then(function(a){var b=q("div",{className:"story-root"},r(a,"div",!0));d.appendChild(b);l("/items","?ids="+a.kids.join(",")).then(function(a){var c=q("ul",{className:"root"});m(c,!1,a);b.appendChild(c)})})}
function t(a,b){var c;b=void 0===b?0:b;c=void 0===c?30:c;return new Promise(function(f){var e=new XMLHttpRequest;e.addEventListener("load",function(){f(JSON.parse(this.responseText))});e.open("GET","/stories.json?scope="+a+"&offset="+b+"&num="+c);e.send()})}function q(a,b,c){b=b?b:{};var f=document.createElement(a),e;for(e in b)f[e]=b[e];Array.from(arguments).slice(2).forEach(function(a){return f.appendChild("string"===typeof a?new Text(a):a)});return f}
function r(a,b,c){c=void 0===c?!1:c;return q(void 0===b?"li":b,{className:"story"},q("div",{className:"headline"},q("div",{hidden:void 0===a.idx},a.idx+1+"."),q("div",{},q("a",{href:a.url||"/story/"+a.id,className:"title"},a.title,q("div",{className:"sub-info"},q("div",{},a.score+" points |"),q("div",{},"by "+a.by+" |"),q("a",{"story-id":a.id,className:"comments",href:"/story/"+a.id,hidden:void 0===a.descendants},a.descendants+" comments"))))),q("div",{className:"story-text",innerHTML:a.text,hidden:!(c&&
void 0!==a.text)}))}function h(a,b){d.innerHTML="";t(b,a).then(function(a){d.appendChild(a.reduce(function(a,b){return a.appendChild(r(b))&&a},q("ul",{id:"stories"})))})}window.onpopstate=function(a){if(void 0!==a.state.offset){var b=window.location.pathname.match(g);h(a.state.offset,("/"===b[0]?"top":b[0])+"stories")}else k(a.state.a)};
if(match=window.location.pathname.match(g)){var u="/"===match[0]?"top":match[0];history.replaceState({offset:0},"","/"+u);h(0,u+"stories")}else{var v=window.location.pathname.match(/story\/(\d+)/)[1];history.pushState({a:v},"","/story/"+v);k(v)};
